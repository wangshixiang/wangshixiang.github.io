# 易代理快速增长的表的处理

[TOC]

## 需要处理的表

- 收件人信息表
- 订单表
- 订单商品表

###  收件人信息表

- 写入场景

  > 新建订单时会创建收件人信息

- 读取场景

  - 订单详情时进行联表查询带出下单信息
  - 通过收件人信息查询订单号


### 订单表

订单信息主表

### 商品表

商品信息表，一条订单记录可能有多条商品记录



## 处理方案

1. 统计分析进行调整

   沿用或新建数据分析结果表

   - 对于一周以前的数据进行锁定不允许修改
   - 每月八号凌晨执行计划任务统计上个月的数据
   - 每年一月九号执行计划任务统计去年的数据
   - 实时统计结果的查询使用从库进行

2. 收件人信息表迁移

   根据网上的说法，性能瓶颈都是几千万条的时候，先不动了，等订单量上500万再来处理

3. 订单及商品表

   几种分表方案

   - 使用mysql自带的功能进行分区或分片，或使用开源方案分库分表

     > 不需要改动逻辑代码，当前还没有达到这个数据量，分区后需要对sql进行优化，尽量每条sql都带上分区key，例如以年份作分区key，查询时都带上年份做查询条件。

   - 按照时间如年份进行逻辑代码调整，手动分表

     > 需要进行逻辑代码调整，方案需要再设计

   - 按照供应商进行表格隔离

     > 极端用户如亚捷果业这种，还是要继续分表，需要大面积修改代码

## 当前需要处理的问题

1. 统计优化
2. sql优化
3. 目前mysql还够用，不够用买rds，加上面的分表









##  